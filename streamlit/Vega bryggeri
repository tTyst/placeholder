import streamlit as st
import pandas as pd
import plotly.express as px

# Main content
st.header("Vega Bryggeri Dashboard")
st.markdown("With this dashboard, the goal is to provide Vega Bryggeri with insights into various types of data.")

# Load data function
@st.cache_data()
def load_data(year):
    file_path = f"Artikellistan {year}.xlsx"  # Assuming the files are named by year
    data = pd.read_excel(file_path, header=4)
    return data

# Function to get top sales data for Vega Bryggeri
@st.cache_data()
def get_top_vega_bryggeri(data):
    filtered_data = data[data['Producentnamn'] == 'Vega Bryggeri']
    top_sales = filtered_data.sort_values(by='Försäljning i liter', ascending=False).head(50)
    return top_sales

# Function to prepare comparative data
def get_comparative_data():
    years = [2018, 2019, 2020, 2021, 2022, 2023]
    frames = []
    for year in years:
        data = load_data(year)
        total_sales = data[data['Producentnamn'] == 'Vega Bryggeri']['Försäljning i liter'].sum()
        frames.append(pd.DataFrame({'Year': [year], 'Sales': [total_sales]}))
    return pd.concat(frames)

# Sidebar
st.sidebar.title("Menu")

# Tabs for analysis
tab1, tab2 = st.tabs(["Yearly Analysis", "Comparative Analysis"])

with tab1:
    year = st.selectbox("Select Year", (2023, 2022, 2021, 2020, 2019, 2018))
    data = load_data(year)
    st.subheader("Top Most Sold Beverages by Vega Bryggeri")
    top_vega = get_top_vega_bryggeri(data)
    fig = px.bar(top_vega, x='Namn', y='Försäljning i liter',
                 labels={'Försäljning i liter': 'Försäljning i Liter', 'Namn': 'Produkt Namn'},
                 title="Top Produkter från Vega Bryggeri baserat på Försäljning i liter")
    st.plotly_chart(fig, use_container_width=True)
    top_vega = top_vega[['Kvittonamn', 'Producentnamn', 'Försäljning i liter', 'Varugrupp detalj']].reset_index(drop=True)
    # Increment the index to start from 1 instead of 0
    top_vega.index = top_vega.index + 1
    st.dataframe(top_vega)

with tab2:
    st.subheader("Comparative Sales Data Across Years")
    comparative_data = get_comparative_data()
    fig = px.line(comparative_data, x='Year', y='Sales',
                  labels={'Sales': 'Sales in Liters', 'Year': 'Year'},
                  title='Sales Comparison Over Years')
    st.plotly_chart(fig, use_container_width=True)

# Footer
st.markdown("---")
st.markdown("Created by Algorithm Avengers with :heart: for Vega Bryggeri.")

if __name__ == "__main__":
    def main():
        pass  # Main function definition is empty as Streamlit runs script top-down

    main()
